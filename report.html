<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
  <head>
    <meta http-equiv="Content-Type" content= "text/html; charset=iso-8859-1">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Dylan Leigh - 3017239 - CNE1 Lab 3 Report</title>
    <link href="style.css" rel="StyleSheet" type="text/css">
  </head>

  <body>

    <br>
    <hr>
    <br>

    <h1>CNE1 Lab 3 Report</h1>
    <blockquote>
      <b>Dylan Leigh</b><br>
       Student Number: <b>3017239</b><br>
    </blockquote>

    <p>Note: this file is raw HTML with no style information. It may be
    easier to view this in a thin window so the text does not stretch
    across the entire screen.</p>

    <br>
    <hr>
    <br>
    
    <h2>Problem Definition</h2>

    <p>Design a system to allow a game to be run as a TCP/IP
    client/server system, with the server playing against the user who
    is operating the client. All game rules decisions must be made
    server side and steps should be taken to prevent the client
    cheating.</p>

    <br>
    <hr>
    <br>
    
    <h2>Design and Implementation Process</h2>

    <p>The first step was the design of the game rules. I created my own
    game, the rules are outlined in the <a href="readme.txt">
       readme.txt</a> file, which also describes how to build the client
    and server. The name "NumLock" was chosen as the main strategy is to
    block the other player from getting high numbers.</p>

    <p>The second was design of the protocol. It was decided that
    the protocol should be text-based so it was human-readable, portable
    and easily extensible. The details of the protocol can be found in
    the <i>Protocol</i> section below.</p>

    <p>The implementation was done using Java to ensure portability.
    Java 1.5 (the most recent major version) was used.</p>

    <p>The server was implemented first. Because it would not be taking
    any direct user input it was designed as a console program. Basic
    testing was performed on the server by connecting to the server
    using telnet and typing in responses (remember that the protocol was
    text).</p>

    <p>The client was then implemented using a Java Swing GUI. There are
    three UI "panes" - one for connecting to the server, one for viewing
    high scores and selecting game difficulty and another for playing
    the actual game. These were chosen to fit in well with the protocol.</p>

    <h3>Software Testing</h3>

    <p>As mentioned above, some basic testing was done on the server
    using telnet. After the client was finished extensive testing was
    done on both by playing the game.</p>
    
    <p>The client and server were also tested by attempting to connect
    using a different program or service (e.g. connecting to a web
    server using the NumLock client, or accessing the NumLock server
    using a web browser). If the other end does not appear to be using
    the NumLock protocol the server/client terminates the connection.</p>

    
    <h3>Design Diagrams</h3>

   <img src="appclasses.png">
    
    
    <br>
    <hr>
    <br>

    <h2>Protocol</h2>

    <p>All communications are in ASCII text. Generally messages are
    terminated by a newline, although some messages span multiple lines
    (such as when sending high scores). These multiline messages have a
    unique ending line.</p>

    <p>Server and client wait for the other side to transmit a complete
    message, and it responds with another complete message (thus
    communication is half-duplex at all times). An exception is at the
    end of the game, when the server sends two messages, however, there
    is a special flag in the first message to warn the client in this
    case. This considerably simplifies the implementation.</p>
    
    <p>On any unexpected input
    the server/client should terminate the connection.</p>
    
    <p>The basic process is as follows:
    <ol>
       <li>Client initialtes connection to the server
       <li>Server sends <i>server hello</i> message.
       <li>Client sends <i>client hello</i> message.
       <li>Server sends <i>High Scores</i> message.
       <li>Client sends <i>Game Parameters</i> message. (This is a
       request for a new game).
       <li>Server sends <i>Game State</i> message. This contains the
       inital state of the game which is randomly generated by the
       server.
       <li>Client sends a <i>Game Move</i> message.
       <li>Server sends a <i>Game Update</i> message. (This may include the
       server's move, a message that the game has finished or both).
       <li>This process continues from <b>7</b> until the game is finished
       (indicated in the <i>Game Update</i> message).
       <li>When the game has finished the process restarts from
       <b>4</b>, the server sends a <i>High Scores</i> message
       immediately after the <i>Game Update</i> message.
    </ol>
    When the client no longer wishes to play on the server it simply
    terminates the connection.
    </p>

    <p>The details of the various messages follow:</p>
    
    <h4>Server Hello</h4>
    <blockquote>Sent from server to client</blockquote>

    <p>"<code>NumLock server- protocol version <i>x.y</i></code>" where <i>x</i> is the
    major version number and <i>y</i> is the minor version number.  This
    version is 1.0. If a client encounters an unexpected version number
    it should warn the user.</p>
    
    <h4>Client Hello</h4>
    <blockquote>Sent from client to server<br>Multiline (2 lines)</blockquote>

    <p>The first line is "<code>NumLock client- protocol version
       <i>x.y</i></code>" where <i>x</i> and <i>y</i> are the major and minor
    version numbers. The server typically should accept all connections
    regardless of version.</p>

    <p>The second line is "<code>Player Name: <i>xxx</i></code>" where
    <i>xxx</i> is the player name, which may include whitespace (i.e.
    everything on the line after the semicolon and space is used as the
    player name).</p>
    
    <h4>High Scores</h4>
    <blockquote>Sent from server to client<br>Multiline (variable)</blockquote>
    
    <p>The first line should read "<code>High Scores follow:</code>".
    After this there is a number of sections for each difficulty level.</p>

    <p>Each section begins with a blank line, followed by a line with
    the description of the difficulty level (in 1.0 these are "Easy",
    "Normal" and "Hard"). Afterwards there are a set of lines that
    contain the actual scores - each line consisting of the score
    itself, a tab character, and the player name (which may include
    whitespace - the player name is the remainder of the line as in the
    Client Hello message).</p>

    <p>The final line should read "<code>End High Scores. Transmit game
       parameters</code>"</p>
    
    <pre>
For Example:

High Scores follow:
Easy

101             David
38              Dylan
30              bob
23              Emil
2               Synapse
Medium

109             Dylan
109             David
97              David
20              fghghj
10              fghghj
Hard

48              Synapse
24              Synapse
15              dylan
6               Synapse
3               Synapse

End High Scores. Transmit game parameters
    </pre>

    <h4>Game Parameters</h4>
    <blockquote>Sent from client to server</blockquote>

    <p>"<code>Newgame difficulty: <i>x</i></code>" where <i>x</i> is the
    difficulty level - 0 is easy, 1 is normal, 2 is hard. In later
    versions other options could be given such as who starts first or
    the dimensions of the game board. Also, more difficulty levels could
    be included.</p>

    <h4>Game State</h4>
    <blockquote>Sent from server to client<br>Multiline (variable)</blockquote>

    <p>The first line should read "<code>Initial Game State
       follows:</code>". Afterward there is a grid of numbers with each
    column seperated by whitespace and each row seperated by a newline.
    In version 1.0 this is limited to a 10 by 10 grid with a space
    before each number.</p>

    <p>The final line (or 2 lines) depend on whether the player or
    server move first. This is decided randomly by the server in version
    1.0.</p>
    
    <p>If the
    player moves first the server also chooses which row the player can
    move in, at random. The server sends the final line
    "<code>Player move row <i>x</i></code>" where <i>x</i> is the row
    (between 0 and 9 as the grid is 10 by 10 in version 1.0).</p>

    <p>If the server moves first the message is sent over two lines. The
    first is "<code>CPU move <i>x,y</i></code>" where <i>x</i> is the
    column (x position) and <i>y</i> is the row (y position) of the
    server's move (both limited to 0-9 in version 1.0). The second line
    is "<code>"Scores: Player <i>x</i>, CPU <i>y</i></code>" where
    <i>x</i> is the player score and <i>y</i> is the server score.</p>

    <pre>
Example 1: Player moves first

Initial Game State follows:
2 3 6 5 1 7 8 8 9 4
2 1 7 5 2 2 6 1 1 2
8 8 5 2 6 6 7 7 8 2
5 3 2 4 1 6 2 1 9 7
3 3 9 9 3 2 3 3 3 9
6 8 5 6 1 8 1 5 8 5
8 8 5 3 1 6 1 2 1 2
4 5 3 3 3 5 2 9 5 2
3 6 9 8 4 4 2 3 3 2
9 6 2 9 6 7 2 6 8 4
Player move row 0


Example 2: Server moves first

Initial Game State follows:
8 1 2 2 2 9 3 8 7 4
7 9 1 7 6 1 6 1 3 6
2 8 2 5 8 9 5 1 2 1
5 9 2 2 7 2 2 6 1 2
1 7 8 6 6 8 7 6 1 9
2 9 3 4 6 8 3 5 9 7
2 1 9 9 9 4 8 3 3 5
2 1 7 3 1 9 1 2 1 4
8 8 9 8 6 4 9 4 4 9
3 1 8 8 9 7 4 3 5 7
CPU move 0,0
Scores: Player 0, CPU 8
    </pre>
    
    <h4>Game Move</h4>
    <blockquote>Sent from client to server</blockquote>

    <p>"<code>Move <i>x,y</i></code>" where <i>x</i> is the column and
    <i>y</i> is the row of the move the player has made. If the row
    does not match with the previous server move the server should send
    a message such as "Illegal Row Jumping" and close the connection.</p>

    <h4>Game Update</h4>
    <blockquote>Sent from server to client<br>Multiline (variable)</blockquote>

    <p>The first line should read "<code>"Scores: Player <i>x</i>, CPU
       <i>y</i></code>" where <i>x</i> is the player score and <i>y</i>
    is the server score. Note that this is the same as one of the
    possible final lines of the Game State message.</p>

    <p>If the game is not over yet, the server sends it's move in the
    form "<code>CPU Move <i>x,y</i></code>" where <i>x</i> is the column
    and <i>y</i> is the row of the server's move.</p>

    <p>If the game is over (with or without the server move!) the server
    sends a line reading "<code>Endgame</code>" or "<code>Endgame -
       HighScore</code>" if the player achieved a high score.
    
    <p>Finally, the server sends a score line ("<code>"Scores: Player
       <i>x</i>, CPU <i>y</i></code>" where <i>x</i> is the player score
    and <i>y</i> is the server score) and this is the end of the
    message.</p>

    <br>
    <hr>
    <br>
    
    <h2>Reflections</h2>

    <p>The game itself has been popular with several other students and
    I am considering wrtiing a multithreaded server to allow serveral
    people to connect, or expanding the system so that people can play
    against each other.</p>

    <br>
    <hr>
    <br>

    <h2>Acknowledgements</h2>

    <p>Thanks to Mike (quex.org) for thinking up the name of the
    game.<br> David Marshall and Steven Buck assisted me with testing
    the client.</p>

    <br>
    <hr>
    <br>

    <p>Copyright &copy; Dylan Leigh 2004-2005.</p>
    
    <br>
    <hr>
    <br>

  </body>
</html>

